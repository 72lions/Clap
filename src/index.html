<!DOCTYPE html>
<html>
<head>
    <title>Alfons goes for a walk</title>

    <link rel="stylesheet" type="text/css" href="assets/css/style.css"></link>

</head>
<body>
    <div id="container">
        <h1>Alfons goes for a walk</h1>
        <div id="cr-stage">
        </div>
        <p>Jump, jump, jump!</p>
    </div>

    <script src="js/vendor/crafty-0.5.3-patch.js"></script>
    <script src="js/vendor/underscore-1.4.2.js"></script>
    <script src="js/vendor/jquery-1.8.2.js"></script>
    <script src="js/utilities.js"></script>
    <script src="js/background.js"></script>
    <script src="js/gravity.js"></script>
    <script src="js/platform.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/player.js"></script>
    <script src="js/game.js"></script>
    <script>
        window.addEventListener('load', function(e) {
            function hasGetUserMedia() {
              // Note: Opera is unprefixed.
              return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
                        navigator.mozGetUserMedia || navigator.msGetUserMedia);
            }

            if (hasGetUserMedia()) {
                // Good to go!
                console.log('We have getUserMedia');
                var context = new window.webkitAudioContext();
                navigator.webkitGetUserMedia({audio: true}, function(stream) {

                  var gainNode = context.createGainNode();
                  gainNode.type = 3;
                  gainNode.gain.value = 1;

                  var microphone = context.createMediaStreamSource(stream);
                  var analyser = context.createAnalyser();
                  var javascriptNode = context.createJavaScriptNode(2048, 1, 1);

                  analyser.smoothingTimeConstant = 0;
                  analyser.fftSize = 512;

                  microphone.connect(analyser);
                  analyser.connect(javascriptNode);
                  javascriptNode.connect(gainNode);
                  gainNode.connect(context.destination);



                  javascriptNode.onaudioprocess = function() {
                    // get the average for the first channel
                    var array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);

                    var total = 0;
                    var average = 0;

                    for (var i = 0; i < array.length; i++) {
                        total += array[i];
                    }


                    average = total / array.length;

                    if (average >= 90) {
                        console.log('JUMP');
                    }


                  };



                  //analyser.connect(context.destination);
                  //setInterval(function() {

                  //}, 100);

                }, function() {
                    console.log('FAIL DUDE!!!');
                });
            } else {
              alert('getUserMedia() is not supported in your browser');
            }
        }, false);
    </script>
</body>
</html>
